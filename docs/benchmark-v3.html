<!DOCTYPE html>
<html>
<head>
  <title>Benchmark</title>
  <meta charset="utf-8">
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
  </style>
</head>
<body>
  <div id="total-time-heatmap"></div>
  <div id="max-memory-heatmap"></div>
  <script>(() => {
    // Define properties
    const common_data_props = {
      type: 'heatmap',
      x: [
        'Python-PyTorch',
        'Python-ORT',
        'Python-ORT-Quantized',
        'Rust-ORT',
        'Rust-ORT-Quantized',
      ],
      y: [
        'x1',
        'x2',
        'x4',
        'x8',
        'x16',
      ],
      colorscale: [
        [0.0, 'hsl(120, 80%, 60%)'],
        [0.2, 'hsl(96, 80%, 60%)'],
        [0.4, 'hsl(72, 80%, 60%)'],
        [0.6, 'hsl(48, 80%, 60%)'],
        [0.8, 'hsl(24, 80%, 60%)'],
        [1.0, 'hsl(0, 80%, 60%)'],
      ],
      xgap: 1,
      ygap: 1,
    };
    const get_layout_props = (title_text) => ({
      title: {
        text: title_text,
        font: {
          size: 20,
        },
      },
      displaylogo: false,
      width: window.innerWidth,
      height: window.innerHeight,
      autosize: false,
      xaxis: {
        title: {
          text: 'Approach',
          font: {
            size: 16,
          },
        },
      },
      yaxis: {
        title: {
          text: 'Batch Size',
          font: {
            size: 16,
          },
        },
        type: 'category',
      },
    });

    // Load data
    const total_time_zdata = [
      [164, 100, 101, 80, 84],
      [121, 106, 111, 80, 87],
      [106, 144, 162, 106, 113],
      [129, 176, 180, 115, 126],
      [141, 169, 177, 128, 144],
    ];
    const max_memory_zdata = [
      [396, 410, 326, 173, 80],
      [396, 412, 329, 173, 81],
      [396, 415, 333, 174, 85],
      [396, 422, 344, 178, 101],
      [396, 436, 375, 197, 136],
    ];

    // Process data
    let flatten_zdata = total_time_zdata.flat();
    let max_value = Math.max(...flatten_zdata);
    const total_time_annotations =
      total_time_zdata
        .map((array, yindex) => (
          array.map((value, xindex) => ({
            x: common_data_props.x[xindex],
            y: common_data_props.y[yindex],
            text: (value / max_value).toFixed(2),
            showarrow: false,
          }))
        )).flat();
    flatten_zdata = max_memory_zdata.flat();
    max_value = Math.max(...flatten_zdata);
    const max_memory_annotations =
      max_memory_zdata
        .map((array, yindex) => (
          array.map((value, xindex) => ({
            x: common_data_props.x[xindex],
            y: common_data_props.y[yindex],
            text: (value / max_value).toFixed(2),
            showarrow: false,
          }))
        )).flat();

    // Build plots
    Plotly.newPlot('total-time-heatmap',
      [
        {
          ...common_data_props,
          z: total_time_zdata,
        },
      ],
      {
        ...get_layout_props('Total time (s)'),
        annotations: total_time_annotations,
      },
    );
    Plotly.newPlot('max-memory-heatmap',
      [
        {
          ...common_data_props,
          z: max_memory_zdata,
        },
      ],
      {
        ...get_layout_props('Maximum memory usage (MiB)'),
        annotations: max_memory_annotations,
      },
    );
  })();</script>
</body>
</html>